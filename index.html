<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="å°ˆæ¥­æœ¬ç›Šæ¯”åˆ†æå¹³å° - Professional P/E Ratio Analysis Platform">
    <link rel="manifest" href="data:application/json,{%22name%22:%22P/Eåˆ†æ%22,%22short_name%22:%22PE%22,%22start_url%22:%22/%22,%22display%22:%22standalone%22,%22background_color%22:%22%23ffffff%22,%22theme_color%22:%22%23667eea%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 192 192%27%3E%3Crect fill=%27%23667eea%27 width=%27192%27 height=%27192%27/%3E%3Ctext x=%2750%25%27 y=%2750%25%27 font-size=%27100%27 fill=%27white%27 text-anchor=%27middle%27 dominant-baseline=%27middle%27%3EP/E%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22}]}">
    <title>å°ˆæ¥­æœ¬ç›Šæ¯”åˆ†æå¹³å° | Professional P/E Analysis Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #22c55e;
            --danger-color: #ef4444;
            --warning-color: #f97316;
            --info-color: #3b82f6;
            --bg-primary: #ffffff;
            --bg-secondary: #f5f7fa;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
        }
        
        body.dark-mode {
            --bg-primary: #1e1e1e;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #444444;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            transition: background 0.3s ease;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            border-radius: 5px;
            font-size: 0.9em;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .btn:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.8em;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-info {
            background-color: var(--info-color);
        }
        
        .search-box {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 5px;
            font-size: 0.9em;
            min-width: 200px;
        }
        
        .search-results {
            position: absolute;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .search-result-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }
        
        .search-result-item:hover {
            background-color: var(--bg-secondary);
        }
        
        .language-select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 1.2em;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .meta {
            font-size: 0.9em;
            color: var(--text-secondary);
        }
        
        .update-time {
            background-color: var(--bg-secondary);
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.85em;
            border-left: 4px solid var(--primary-color);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tab-btn {
            padding: 10px 20px;
            border: none;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 5px;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .tab-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .card h4 {
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .stock-detail-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .stock-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }
        
        .detail-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .chart-container {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            position: relative;
            height: 400px;
            border: 1px solid var(--border-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1em;
        }
        
        .form-group button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .form-group button:hover {
            opacity: 0.8;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .table th {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .table tr:hover {
            background-color: var(--bg-secondary);
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .badge-success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .badge-danger {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .badge-warning {
            background-color: #fff3e0;
            color: #e65100;
        }
        
        .badge-info {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .recommendation {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid var(--warning-color);
            background: var(--bg-secondary);
        }
        
        .recommendation-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .recommendation-reason {
            font-size: 0.9em;
            color: var(--text-secondary);
        }
        
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 12px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #c62828;
        }
        
        .success-message {
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 12px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #2e7d32;
        }
        
        .info-message {
            background-color: #e3f2fd;
            color: #1565c0;
            padding: 12px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #1565c0;
        }
        
        .financial-ratio {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .ratio-card {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        .ratio-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .ratio-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .technical-indicator {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 4px solid var(--info-color);
        }
        
        .indicator-name {
            font-weight: bold;
        }
        
        .indicator-value {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .indicator-status {
            font-size: 0.85em;
            padding: 3px 8px;
            border-radius: 3px;
            background: var(--bg-primary);
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
            
            .chart-container {
                height: 300px;
            }
            
            .top-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn, .language-select, .search-box {
                width: 100%;
            }
            
            .stock-detail-grid {
                grid-template-columns: 1fr;
            }
            
            .financial-ratio {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-small" onclick="toggleTheme()">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>
                <div style="position: relative;">
                    <input type="text" class="search-box" id="searchBox" placeholder="æœç´¢è‚¡ç¥¨ä»£ç¢¼..." onkeyup="performSearch()">
                    <div class="search-results" id="searchResults" style="display: none;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <select class="language-select" onchange="changeLanguage(this.value)">
                    <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                    <option value="en">English</option>
                    <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                </select>
                <button class="btn btn-small" onclick="exportPDF()">ğŸ“¥ PDF</button>
                <button class="btn btn-small" onclick="exportCSV()">ğŸ“Š CSV</button>
            </div>
        </div>
        
        <header>
            <h1 id="title">å°ˆæ¥­æœ¬ç›Šæ¯”åˆ†æå¹³å°</h1>
            <p class="subtitle" id="subtitle">Professional P/E Ratio Analysis Platform</p>
            <div class="meta">
                <span id="author">ä½œè€…ï¼šAI é‡‘èåˆ†æå¸«</span> â€¢ 
                <span id="date">ç™¼å¸ƒæ—¥æœŸï¼š2025å¹´11æœˆ6æ—¥</span> â€¢ 
                <span id="source">æ•¸æ“šä¾†æºï¼šå¤šé‡æ¬Šå¨é‡‘èæ•¸æ“šæä¾›å•†</span>
            </div>
            <div class="update-time" id="updateTime">
                â° æœ€å¾Œæ›´æ–°æ™‚é–“ï¼šæ­£åœ¨åŠ è¼‰...
            </div>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab(event, 'dashboard')" id="tab-dashboard">ğŸ“Š å„€è¡¨æ¿</button>
            <button class="tab-btn" onclick="switchTab(event, 'stockDetail')" id="tab-stockDetail">ğŸ“‹ è‚¡ç¥¨è©³æƒ…</button>
            <button class="tab-btn" onclick="switchTab(event, 'compare')" id="tab-compare">âš–ï¸ å°æ¯”åˆ†æ</button>
            <button class="tab-btn" onclick="switchTab(event, 'recommendation')" id="tab-recommendation">ğŸ’¡ æŠ•è³‡å»ºè­°</button>
            <button class="tab-btn" onclick="switchTab(event, 'technical')" id="tab-technical">ğŸ“ˆ æŠ€è¡“åˆ†æ</button>
            <button class="tab-btn" onclick="switchTab(event, 'financial')" id="tab-financial">ğŸ’° è²¡å‹™æ¯”ç‡</button>
        </div>
        
        <!-- Stock Detail Tab -->
        <div id="stockDetail" class="tab-content">
            <div class="card">
                <h3>ğŸ“‹ è‚¡ç¥¨è©³ç´°ä¿¡æ¯</h3>
                <div class="form-group">
                    <label>è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼</label>
                    <input type="text" id="detailSymbol" placeholder="ä¾‹å¦‚ï¼šAAPL" value="AAPL">
                    <button onclick="loadStockDetail()">æŸ¥è©¢è©³æƒ…</button>
                </div>
                
                <div id="detailError" style="display: none;"></div>
                <div id="detailContent"></div>
            </div>
        </div>
        
        <!-- Compare Tab -->
        <div id="compare" class="tab-content">
            <div class="card">
                <h3>âš–ï¸ å¢å¼·å°æ¯”åˆ†æ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>è‚¡ç¥¨ä»£ç¢¼ 1</label>
                        <input type="text" id="compareSymbol1" placeholder="ä¾‹å¦‚ï¼šAAPL" value="AAPL">
                    </div>
                    <div class="form-group">
                        <label>è‚¡ç¥¨ä»£ç¢¼ 2</label>
                        <input type="text" id="compareSymbol2" placeholder="ä¾‹å¦‚ï¼šMSFT" value="MSFT">
                    </div>
                    <div class="form-group">
                        <label>è‚¡ç¥¨ä»£ç¢¼ 3</label>
                        <input type="text" id="compareSymbol3" placeholder="ä¾‹å¦‚ï¼šGOOGL" value="GOOGL">
                    </div>
                </div>
                
                <button class="btn" onclick="performEnhancedComparison()" style="width: 100%; margin-bottom: 20px;">âš–ï¸ åŸ·è¡Œå°æ¯”</button>
                
                <div id="comparisonError" style="display: none;"></div>
                <div id="comparisonContent"></div>
            </div>
        </div>
        
        <!-- Recommendation Tab -->
        <div id="recommendation" class="tab-content">
            <div class="card">
                <h3>ğŸ’¡ AI æŠ•è³‡å»ºè­°å¼•æ“</h3>
                <div class="form-group">
                    <label>è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼</label>
                    <input type="text" id="recommendSymbol" placeholder="ä¾‹å¦‚ï¼šAAPL" value="AAPL">
                    <button onclick="getInvestmentRecommendation()">ç²å–å»ºè­°</button>
                </div>
                
                <div id="recommendError" style="display: none;"></div>
                <div id="recommendContent"></div>
            </div>
        </div>
        
        <!-- Technical Tab -->
        <div id="technical" class="tab-content">
            <div class="card">
                <h3>ğŸ“ˆ æŠ€è¡“é¢åˆ†æ</h3>
                <div class="form-group">
                    <label>è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼</label>
                    <input type="text" id="technicalSymbol" placeholder="ä¾‹å¦‚ï¼šAAPL" value="AAPL">
                    <button onclick="loadTechnicalAnalysis()">åˆ†æ</button>
                </div>
                
                <div id="technicalError" style="display: none;"></div>
                <div id="technicalContent"></div>
            </div>
        </div>
        
        <!-- Financial Tab -->
        <div id="financial" class="tab-content">
            <div class="card">
                <h3>ğŸ’° è²¡å‹™æ¯”ç‡åˆ†æ</h3>
                <div class="form-group">
                    <label>è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼</label>
                    <input type="text" id="financialSymbol" placeholder="ä¾‹å¦‚ï¼šAAPL" value="AAPL">
                    <button onclick="loadFinancialRatios()">åˆ†æ</button>
                </div>
                
                <div id="financialError" style="display: none;"></div>
                <div id="financialContent"></div>
            </div>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="card">
                <h3>ğŸ“Š å¸‚å ´æ¦‚è¦½</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div class="card">
                        <h4>æ¨™æ™® 500</h4>
                        <div style="font-size: 1.5em; font-weight: bold; color: #667eea; margin: 10px 0;">29.2</div>
                        <div style="font-size: 0.9em; color: var(--text-secondary);">P/E æ¯”ç‡</div>
                        <div style="margin-top: 10px;">
                            <span class="badge badge-danger">é«˜ä¼° +73.8%</span>
                        </div>
                    </div>
                    <div class="card">
                        <h4>ç´æ–¯é”å…‹</h4>
                        <div style="font-size: 1.5em; font-weight: bold; color: #764ba2; margin: 10px 0;">36.5</div>
                        <div style="font-size: 0.9em; color: var(--text-secondary);">P/E æ¯”ç‡</div>
                        <div style="margin-top: 10px;">
                            <span class="badge badge-danger">é«˜ä¼° +63.4%</span>
                        </div>
                    </div>
                    <div class="card">
                        <h4>æ’ç”ŸæŒ‡æ•¸</h4>
                        <div style="font-size: 1.5em; font-weight: bold; color: #22c55e; margin: 10px 0;">11.8</div>
                        <div style="font-size: 0.9em; color: var(--text-secondary);">P/E æ¯”ç‡</div>
                        <div style="margin-top: 10px;">
                            <span class="badge badge-success">ä½ä¼° -9.8%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2025 å°ˆæ¥­æœ¬ç›Šæ¯”åˆ†æå¹³å°ã€‚æ‰€æœ‰æ•¸æ“šåƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆæŠ•è³‡å»ºè­°ã€‚æŠ•è³‡å‰è«‹è«®è©¢å°ˆæ¥­è²¡å‹™é¡§å•ã€‚</p>
        </div>
    </div>
    
    <script>
        // Comprehensive stock data
        const stockData = {
            "AAPL": {
                "name": "Apple Inc.",
                "sector": "Technology",
                "pe": 35.99,
                "price": 268.47,
                "change": -0.48,
                "score": 7.2,
                "pb": 45.2,
                "ps": 8.5,
                "peg": 2.1,
                "roe": 85.3,
                "roa": 18.2,
                "debt": 0.65,
                "dividend": 0.92,
                "week52High": 280.5,
                "week52Low": 195.3,
                "marketCap": "2.8T",
                "recommendation": "æŒæœ‰",
                "rsi": 65,
                "macd": "æ­£",
                "bollingerBands": "ä¸­ç·š"
            },
            "MSFT": {
                "name": "Microsoft Corporation",
                "sector": "Technology",
                "pe": 35.34,
                "price": 496.82,
                "change": -0.06,
                "score": 7.4,
                "pb": 12.5,
                "ps": 15.2,
                "peg": 1.8,
                "roe": 42.1,
                "roa": 15.8,
                "debt": 0.45,
                "dividend": 0.68,
                "week52High": 520.3,
                "week52Low": 380.2,
                "marketCap": "3.7T",
                "recommendation": "è²·é€²",
                "rsi": 58,
                "macd": "æ­£",
                "bollingerBands": "ä¸­ç·š"
            },
            "GOOGL": {
                "name": "Alphabet Inc.",
                "sector": "Technology",
                "pe": 27.55,
                "price": 278.83,
                "change": -2.08,
                "score": 7.1,
                "pb": 5.2,
                "ps": 6.8,
                "peg": 1.5,
                "roe": 18.5,
                "roa": 12.3,
                "debt": 0.15,
                "dividend": 0,
                "week52High": 295.2,
                "week52Low": 220.1,
                "marketCap": "1.8T",
                "recommendation": "æŒæœ‰",
                "rsi": 52,
                "macd": "æ­£",
                "bollingerBands": "ä¸­ç·š"
            },
            "NVDA": {
                "name": "NVIDIA Corporation",
                "sector": "Technology",
                "pe": 53.45,
                "price": 188.15,
                "change": 0.04,
                "score": 7.5,
                "pb": 28.5,
                "ps": 22.3,
                "peg": 2.5,
                "roe": 52.3,
                "roa": 28.5,
                "debt": 0.25,
                "dividend": 0.04,
                "week52High": 195.3,
                "week52Low": 120.5,
                "marketCap": "4.6T",
                "recommendation": "è²·é€²",
                "rsi": 72,
                "macd": "æ­£",
                "bollingerBands": "ä¸Šç·š"
            },
            "TSLA": {
                "name": "Tesla Inc.",
                "sector": "Automotive",
                "pe": 294.19,
                "price": 429.52,
                "change": -3.68,
                "score": 4.2,
                "pb": 85.2,
                "ps": 12.5,
                "peg": 8.5,
                "roe": 28.5,
                "roa": 8.2,
                "debt": 0.05,
                "dividend": 0,
                "week52High": 520.3,
                "week52Low": 380.2,
                "marketCap": "1.4T",
                "recommendation": "è³£å‡º",
                "rsi": 85,
                "macd": "è² ",
                "bollingerBands": "ä¸Šç·š"
            },
            "0005.HK": {
                "name": "HSBC Holdings",
                "sector": "Finance",
                "pe": 14.88,
                "price": 109.8,
                "change": -0.18,
                "score": 7.8,
                "pb": 0.85,
                "ps": 2.1,
                "peg": 0.95,
                "roe": 5.8,
                "roa": 0.85,
                "debt": 0.35,
                "dividend": 4.2,
                "week52High": 125.3,
                "week52Low": 95.2,
                "marketCap": "2.1T HKD",
                "recommendation": "è²·é€²",
                "rsi": 45,
                "macd": "æ­£",
                "bollingerBands": "ä¸­ç·š"
            }
        };
        
        let isDarkMode = localStorage.getItem('darkMode') === 'true';
        
        if (isDarkMode) {
            document.body.classList.add('dark-mode');
        }
        
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript,self.addEventListener("install",e=>self.skipWaiting());self.addEventListener("activate",e=>e.waitUntil(clients.claim()));');
        }
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
        }
        
        function changeLanguage(lang) {
            localStorage.setItem('language', lang);
        }
        
        function switchTab(event, tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        function performSearch() {
            const query = document.getElementById('searchBox').value.toUpperCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!query) {
                resultsDiv.style.display = 'none';
                return;
            }
            
            const matches = Object.keys(stockData).filter(symbol => symbol.includes(query));
            
            if (matches.length === 0) {
                resultsDiv.style.display = 'none';
                return;
            }
            
            resultsDiv.innerHTML = matches.map(symbol => 
                `<div class="search-result-item" onclick="selectStock('${symbol}')">${symbol} - ${stockData[symbol].name}</div>`
            ).join('');
            resultsDiv.style.display = 'block';
        }
        
        function selectStock(symbol) {
            document.getElementById('detailSymbol').value = symbol;
            document.getElementById('searchBox').value = '';
            document.getElementById('searchResults').style.display = 'none';
            loadStockDetail();
        }
        
        function validateStockCode(symbol) {
            if (!symbol || symbol.length === 0) {
                return { valid: false, message: 'è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼' };
            }
            if (!stockData[symbol]) {
                return { valid: false, message: `è‚¡ç¥¨ä»£ç¢¼ ${symbol} ä¸å­˜åœ¨æˆ–æš«ç„¡æ•¸æ“š` };
            }
            return { valid: true };
        }
        
        function loadStockDetail() {
            const symbol = document.getElementById('detailSymbol').value.toUpperCase();
            const errorDiv = document.getElementById('detailError');
            const contentDiv = document.getElementById('detailContent');
            
            const validation = validateStockCode(symbol);
            if (!validation.valid) {
                errorDiv.innerHTML = `<div class="error-message">${validation.message}</div>`;
                errorDiv.style.display = 'block';
                contentDiv.innerHTML = '';
                return;
            }
            
            errorDiv.style.display = 'none';
            const data = stockData[symbol];
            
            contentDiv.innerHTML = `
                <div class="stock-detail-card">
                    <h2>${symbol} - ${data.name}</h2>
                    <p style="margin-top: 5px; opacity: 0.9;">è¡Œæ¥­ï¼š${data.sector}</p>
                </div>
                
                <div class="stock-detail-grid">
                    <div class="detail-item">
                        <div class="detail-label">è‚¡ç¥¨åƒ¹æ ¼</div>
                        <div class="detail-value">$${data.price}</div>
                        <div style="font-size: 0.9em; margin-top: 5px; color: ${data.change >= 0 ? '#22c55e' : '#ef4444'};">${data.change >= 0 ? '+' : ''}${data.change}%</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">P/E æ¯”ç‡</div>
                        <div class="detail-value">${data.pe}</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">è©•ä¼°ï¼š${data.pe > 25 ? 'é«˜ä¼°' : data.pe > 15 ? 'åˆç†' : 'ä½ä¼°'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">52 å‘¨é«˜é»</div>
                        <div class="detail-value">$${data.week52High}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">52 å‘¨ä½é»</div>
                        <div class="detail-value">$${data.week52Low}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">å¸‚å€¼</div>
                        <div class="detail-value">${data.marketCap}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">è‚¡æ¯ç‡</div>
                        <div class="detail-value">${data.dividend}%</div>
                    </div>
                </div>
                
                <h4>æŠ•è³‡è©•åˆ†</h4>
                <div style="font-size: 2em; font-weight: bold; color: #667eea; margin: 15px 0;">${data.score}/10</div>
                <div style="background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 100%); height: 30px; border-radius: 15px; position: relative; margin-bottom: 20px;">
                    <div style="position: absolute; height: 100%; background: white; width: 3px; border-radius: 2px; top: 0; left: ${data.score * 10}%;"></div>
                </div>
                
                <h4 style="margin-top: 20px;">æ¨è–¦è©•ç´š</h4>
                <div style="margin-bottom: 20px;">
                    <span class="badge ${data.recommendation === 'è²·é€²' ? 'badge-success' : data.recommendation === 'æŒæœ‰' ? 'badge-info' : 'badge-danger'}">${data.recommendation}</span>
                </div>
            `;
        }
        
        function performEnhancedComparison() {
            const symbol1 = document.getElementById('compareSymbol1').value.toUpperCase();
            const symbol2 = document.getElementById('compareSymbol2').value.toUpperCase();
            const symbol3 = document.getElementById('compareSymbol3').value.toUpperCase();
            
            const errorDiv = document.getElementById('comparisonError');
            const contentDiv = document.getElementById('comparisonContent');
            
            // Validate all symbols
            const val1 = validateStockCode(symbol1);
            const val2 = validateStockCode(symbol2);
            const val3 = validateStockCode(symbol3);
            
            if (!val1.valid || !val2.valid || !val3.valid) {
                errorDiv.innerHTML = `<div class="error-message">è«‹è¼¸å…¥æœ‰æ•ˆçš„è‚¡ç¥¨ä»£ç¢¼</div>`;
                errorDiv.style.display = 'block';
                contentDiv.innerHTML = '';
                return;
            }
            
            errorDiv.style.display = 'none';
            
            const data1 = stockData[symbol1];
            const data2 = stockData[symbol2];
            const data3 = stockData[symbol3];
            
            contentDiv.innerHTML = `
                <h4>å°æ¯”è©³æƒ…</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>æŒ‡æ¨™</th>
                            <th>${symbol1}</th>
                            <th>${symbol2}</th>
                            <th>${symbol3}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>P/E æ¯”ç‡</strong></td>
                            <td>${data1.pe}</td>
                            <td>${data2.pe}</td>
                            <td>${data3.pe}</td>
                        </tr>
                        <tr>
                            <td><strong>è‚¡ç¥¨åƒ¹æ ¼</strong></td>
                            <td>$${data1.price}</td>
                            <td>$${data2.price}</td>
                            <td>$${data3.price}</td>
                        </tr>
                        <tr>
                            <td><strong>P/B æ¯”ç‡</strong></td>
                            <td>${data1.pb}</td>
                            <td>${data2.pb}</td>
                            <td>${data3.pb}</td>
                        </tr>
                        <tr>
                            <td><strong>P/S æ¯”ç‡</strong></td>
                            <td>${data1.ps}</td>
                            <td>${data2.ps}</td>
                            <td>${data3.ps}</td>
                        </tr>
                        <tr>
                            <td><strong>ROE</strong></td>
                            <td>${data1.roe}%</td>
                            <td>${data2.roe}%</td>
                            <td>${data3.roe}%</td>
                        </tr>
                        <tr>
                            <td><strong>è©•åˆ†</strong></td>
                            <td>${data1.score}/10</td>
                            <td>${data2.score}/10</td>
                            <td>${data3.score}/10</td>
                        </tr>
                        <tr>
                            <td><strong>æ¨è–¦</strong></td>
                            <td><span class="badge ${data1.recommendation === 'è²·é€²' ? 'badge-success' : data1.recommendation === 'æŒæœ‰' ? 'badge-info' : 'badge-danger'}">${data1.recommendation}</span></td>
                            <td><span class="badge ${data2.recommendation === 'è²·é€²' ? 'badge-success' : data2.recommendation === 'æŒæœ‰' ? 'badge-info' : 'badge-danger'}">${data2.recommendation}</span></td>
                            <td><span class="badge ${data3.recommendation === 'è²·é€²' ? 'badge-success' : data3.recommendation === 'æŒæœ‰' ? 'badge-info' : 'badge-danger'}">${data3.recommendation}</span></td>
                        </tr>
                    </tbody>
                </table>
            `;
        }
        
        function getInvestmentRecommendation() {
            const symbol = document.getElementById('recommendSymbol').value.toUpperCase();
            const errorDiv = document.getElementById('recommendError');
            const contentDiv = document.getElementById('recommendContent');
            
            const validation = validateStockCode(symbol);
            if (!validation.valid) {
                errorDiv.innerHTML = `<div class="error-message">${validation.message}</div>`;
                errorDiv.style.display = 'block';
                contentDiv.innerHTML = '';
                return;
            }
            
            errorDiv.style.display = 'none';
            const data = stockData[symbol];
            
            let reasons = [];
            if (data.pe < 15) reasons.push('âœ“ P/E æ¯”ç‡ä½æ–¼æ­·å²å¹³å‡ï¼Œå…·æœ‰æŠ•è³‡åƒ¹å€¼');
            if (data.pe > 30) reasons.push('âš  P/E æ¯”ç‡è¼ƒé«˜ï¼Œéœ€è¬¹æ…è©•ä¼°');
            if (data.score >= 7.5) reasons.push('âœ“ æŠ•è³‡è©•åˆ†é«˜æ–¼ 7.5ï¼Œè¡¨ç¾è‰¯å¥½');
            if (data.roe > 20) reasons.push('âœ“ ROE é«˜æ–¼ 20%ï¼Œç›ˆåˆ©èƒ½åŠ›å¼·');
            if (data.debt < 0.5) reasons.push('âœ“ å‚µå‹™æ¯”ç‡ä½ï¼Œè²¡å‹™ç‹€æ³ç©©å¥');
            if (data.dividend > 2) reasons.push('âœ“ è‚¡æ¯ç‡é«˜æ–¼ 2%ï¼Œé©åˆæ”¶æ¯æŠ•è³‡è€…');
            
            contentDiv.innerHTML = `
                <div class="recommendation">
                    <div class="recommendation-title">${symbol} - ${data.name}</div>
                    <div class="recommendation-reason">æ¨è–¦è©•ç´šï¼š<span class="badge ${data.recommendation === 'è²·é€²' ? 'badge-success' : data.recommendation === 'æŒæœ‰' ? 'badge-info' : 'badge-danger'}">${data.recommendation}</span></div>
                </div>
                
                <h4>æŠ•è³‡ç†ç”±</h4>
                ${reasons.map(reason => `<div style="padding: 10px; margin-bottom: 10px; background: var(--bg-secondary); border-radius: 5px;">${reason}</div>`).join('')}
                
                <h4 style="margin-top: 20px;">é¢¨éšªè©•ä¼°</h4>
                <div style="padding: 15px; background: var(--bg-secondary); border-radius: 5px; border-left: 4px solid var(--warning-color);">
                    <div style="margin-bottom: 10px;"><strong>ä¼°å€¼é¢¨éšªï¼š</strong> ${data.pe > 30 ? 'é«˜' : data.pe > 20 ? 'ä¸­' : 'ä½'}</div>
                    <div style="margin-bottom: 10px;"><strong>è²¡å‹™é¢¨éšªï¼š</strong> ${data.debt > 0.7 ? 'é«˜' : data.debt > 0.5 ? 'ä¸­' : 'ä½'}</div>
                    <div><strong>å¸‚å ´é¢¨éšªï¼š</strong> ä¸­ç­‰</div>
                </div>
            `;
        }
        
        function loadTechnicalAnalysis() {
            const symbol = document.getElementById('technicalSymbol').value.toUpperCase();
            const errorDiv = document.getElementById('technicalError');
            const contentDiv = document.getElementById('technicalContent');
            
            const validation = validateStockCode(symbol);
            if (!validation.valid) {
                errorDiv.innerHTML = `<div class="error-message">${validation.message}</div>`;
                errorDiv.style.display = 'block';
                contentDiv.innerHTML = '';
                return;
            }
            
            errorDiv.style.display = 'none';
            const data = stockData[symbol];
            
            contentDiv.innerHTML = `
                <h4>æŠ€è¡“æŒ‡æ¨™</h4>
                <div class="technical-indicator">
                    <div class="indicator-name">RSI (ç›¸å°å¼·åº¦æŒ‡æ¨™)</div>
                    <div class="indicator-value">${data.rsi}</div>
                    <div class="indicator-status" style="background: ${data.rsi > 70 ? '#ffebee' : data.rsi < 30 ? '#e8f5e9' : '#e3f2fd'}; color: ${data.rsi > 70 ? '#c62828' : data.rsi < 30 ? '#2e7d32' : '#1565c0'};">
                        ${data.rsi > 70 ? 'è¶…è²·' : data.rsi < 30 ? 'è¶…è³£' : 'ä¸­æ€§'}
                    </div>
                </div>
                
                <div class="technical-indicator">
                    <div class="indicator-name">MACD (ç§»å‹•å¹³å‡æ”¶æ–‚æ•£åº¦)</div>
                    <div class="indicator-value">${data.macd}</div>
                    <div class="indicator-status" style="background: ${data.macd === 'æ­£' ? '#e8f5e9' : '#ffebee'}; color: ${data.macd === 'æ­£' ? '#2e7d32' : '#c62828'};">
                        ${data.macd === 'æ­£' ? 'çœ‹æ¼²' : 'çœ‹è·Œ'}
                    </div>
                </div>
                
                <div class="technical-indicator">
                    <div class="indicator-name">å¸ƒæ—å¸¶ (Bollinger Bands)</div>
                    <div class="indicator-value">${data.bollingerBands}</div>
                    <div class="indicator-status" style="background: #e3f2fd; color: #1565c0;">
                        ${data.bollingerBands === 'ä¸Šç·š' ? 'æ¥è¿‘ä¸Šç·š' : data.bollingerBands === 'ä¸‹ç·š' ? 'æ¥è¿‘ä¸‹ç·š' : 'åœ¨ä¸­ç·šé™„è¿‘'}
                    </div>
                </div>
                
                <h4 style="margin-top: 20px;">æŠ€è¡“é¢ç¸½çµ</h4>
                <div style="padding: 15px; background: var(--bg-secondary); border-radius: 5px; border-left: 4px solid var(--info-color);">
                    <div style="margin-bottom: 10px;">
                        <strong>çŸ­æœŸè¶¨å‹¢ï¼š</strong> ${data.rsi > 70 ? 'è¶…è²·ï¼Œå¯èƒ½é¢è‡¨å›èª¿' : data.rsi < 30 ? 'è¶…è³£ï¼Œå¯èƒ½åå½ˆ' : 'ä¸­æ€§ï¼Œç¼ºä¹æ˜ç¢ºæ–¹å‘'}
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>å‹•é‡æŒ‡æ¨™ï¼š</strong> ${data.macd === 'æ­£' ? 'æ­£é¢ï¼Œæ”¯æŒä¸Šå‡è¶¨å‹¢' : 'è² é¢ï¼Œæ”¯æŒä¸‹é™è¶¨å‹¢'}
                    </div>
                    <div>
                        <strong>ç¶œåˆè©•ä¼°ï¼š</strong> ${data.score >= 7 ? 'æŠ€è¡“é¢ç›¸å°å¼·å‹¢' : 'æŠ€è¡“é¢ç›¸å°å¼±å‹¢'}
                    </div>
                </div>
            `;
        }
        
        function loadFinancialRatios() {
            const symbol = document.getElementById('financialSymbol').value.toUpperCase();
            const errorDiv = document.getElementById('financialError');
            const contentDiv = document.getElementById('financialContent');
            
            const validation = validateStockCode(symbol);
            if (!validation.valid) {
                errorDiv.innerHTML = `<div class="error-message">${validation.message}</div>`;
                errorDiv.style.display = 'block';
                contentDiv.innerHTML = '';
                return;
            }
            
            errorDiv.style.display = 'none';
            const data = stockData[symbol];
            
            contentDiv.innerHTML = `
                <h4>ä¼°å€¼æ¯”ç‡</h4>
                <div class="financial-ratio">
                    <div class="ratio-card">
                        <div class="ratio-label">P/E æ¯”ç‡</div>
                        <div class="ratio-value">${data.pe}</div>
                        <div style="font-size: 0.85em; color: var(--text-secondary); margin-top: 5px;">
                            ${data.pe < 15 ? 'ä½ä¼°' : data.pe < 25 ? 'åˆç†' : 'é«˜ä¼°'}
                        </div>
                    </div>
                    <div class="ratio-card">
                        <div class="ratio-label">P/B æ¯”ç‡</div>
                        <div class="ratio-value">${data.pb}</div>
                        <div style="font-size: 0.85em; color: var(--text-secondary); margin-top: 5px;">
                            ${data.pb < 1.5 ? 'ä½ä¼°' : data.pb < 3 ? 'åˆç†' : 'é«˜ä¼°'}
                        </div>
                    </div>
                    <div class="ratio-card">
                        <div class="ratio-label">P/S æ¯”ç‡</div>
                        <div class="ratio-value">${data.ps}</div>
                        <div style="font-size: 0.85em; color: var(--text-secondary); margin-top: 5px;">
                            ${data.ps < 2 ? 'ä½ä¼°' : data.ps < 5 ? 'åˆç†' : 'é«˜ä¼°'}
                        </div>
                    </div>
                    <div class="ratio-card">
                        <div class="ratio-label">PEG æ¯”ç‡</div>
                        <div class="ratio-value">${data.peg}</div>
                        <div style="font-size: 0.85em; color: var(--text-secondary); margin-top: 5px;">
                            ${data.peg < 1 ? 'ä½ä¼°' : data.peg < 2 ? 'åˆç†' : 'é«˜ä¼°'}
                        </div>
                    </div>
                </div>
                
                <h4 style="margin-top: 20px;">ç›ˆåˆ©èƒ½åŠ›</h4>
                <div class="financial-ratio">
                    <div class="ratio-card">
                        <div class="ratio-label">ROE (è‚¡æ±æ¬Šç›Šå›å ±ç‡)</div>
                        <div class="ratio-value">${data.roe}%</div>
                        <div style="font-size: 0.85em; color: var(--text-secondary); margin-top: 5px;">
                            ${data.roe > 20 ? 'å„ªç§€' : data.roe > 10 ? 'è‰¯å¥½' : 'ä¸€èˆ¬'}
                        </div>
                    </div>
                    <div class="ratio-card">
                        <div class="ratio-label">ROA (è³‡ç”¢å›å ±ç‡)</div>
                        <div class="ratio-value">${data.roa}%</div>
                        <div style="font-size: 0.85em; color: var(--text-secondary); margin-top: 5px;">
                            ${data.roa > 10 ? 'å„ªç§€' : data.roa > 5 ? 'è‰¯å¥½' : 'ä¸€èˆ¬'}
                        </div>
                    </div>
                    <div class="ratio-card">
                        <div class="ratio-label">è‚¡æ¯ç‡</div>
                        <div class="ratio-value">${data.dividend}%</div>
                        <div style="font-size: 0.85em; color: var(--text-secondary); margin-top: 5px;">
                            ${data.dividend > 3 ? 'é«˜' : data.dividend > 1 ? 'ä¸­' : 'ä½'}
                        </div>
                    </div>
                    <div class="ratio-card">
                        <div class="ratio-label">å‚µå‹™æ¯”ç‡</div>
                        <div class="ratio-value">${data.debt}</div>
                        <div style="font-size: 0.85em; color: var(--text-secondary); margin-top: 5px;">
                            ${data.debt < 0.5 ? 'ä½' : data.debt < 0.7 ? 'ä¸­' : 'é«˜'}
                        </div>
                    </div>
                </div>
                
                <h4 style="margin-top: 20px;">è²¡å‹™è©•ä¼°</h4>
                <div style="padding: 15px; background: var(--bg-secondary); border-radius: 5px; border-left: 4px solid var(--success-color);">
                    <div style="margin-bottom: 10px;">
                        <strong>ä¼°å€¼æ°´å¹³ï¼š</strong> ${data.pe < 15 ? 'ä½ä¼°ï¼Œå…·æœ‰æŠ•è³‡åƒ¹å€¼' : data.pe < 25 ? 'åˆç†ä¼°å€¼' : 'é«˜ä¼°ï¼Œéœ€è¬¹æ…'}
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>ç›ˆåˆ©èƒ½åŠ›ï¼š</strong> ${data.roe > 20 ? 'å„ªç§€' : data.roe > 10 ? 'è‰¯å¥½' : 'ä¸€èˆ¬'}
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>è²¡å‹™å¥åº·ï¼š</strong> ${data.debt < 0.5 ? 'ç©©å¥' : data.debt < 0.7 ? 'è‰¯å¥½' : 'éœ€è¦é—œæ³¨'}
                    </div>
                    <div>
                        <strong>æ•´é«”è©•åˆ†ï¼š</strong> ${data.score}/10
                    </div>
                </div>
            `;
        }
        
        function exportPDF() {
            const element = document.querySelector('.container');
            const opt = {
                margin: 10,
                filename: 'pe-analysis-report.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            html2pdf().set(opt).from(element).save();
        }
        
        function exportCSV() {
            let csv = 'Stock,Name,Sector,P/E,Price,Score,Recommendation\n';
            Object.entries(stockData).forEach(([symbol, data]) => {
                csv += `${symbol},"${data.name}","${data.sector}",${data.pe},${data.price},${data.score},"${data.recommendation}"\n`;
            });
            
            const link = document.createElement('a');
            link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
            link.download = 'pe-analysis-data.csv';
            link.click();
        }
    </script>
</body>
</html>
